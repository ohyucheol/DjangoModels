{% extends "../base.html" %}

{% block title %}J01{% endblock %}

{% block content %}

<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

<script>


// // Creates a new editor instance
// const ed = new tinymce.Editor('aa', {
//   some_setting: 1
// }, tinymce.EditorManager);
// // Rendering editor
// ed.render();



// tinymce.init({
//   selector: 'textarea',
//   toolbar: 'urldialog hoho',
//   setup: (editor) => {
//     // editor.on('click', () => {
//     //   alert('heheh');
//     // });
//     editor.ui.registry.addButton('urldialog', {
//       icon: 'gallery',
//       onAction: () => editor.windowManager.openUrl({
//         title: 'URL Dialog Demo',
//         url: 'https://example.com',
//       })
//     });
//     editor.ui.registry.addButton('hoho', {
//       icon: 'gallery',
//       onAction: () => editor.windowManager.openUrl({
//         title: 'URL hoho Demo',
//         url: 'https://example.com',
//       })
//     });
//   },
//   content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }'
// });


var a = tinymce.init({
  selector: 'textarea',
  toolbar: 'urldialog hoho',
  setup: (editor) => {
    //이때의 editor는 https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor/ 이므로
    //https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/ 이것과
    //https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.ui/ 이것과 연관되어 있다.
    // alert(editor.ui.isEnabled()); 이런 것이 가능
    // alert(JSON.stringify(editor.ui));
    // alert(JSON.stringify(editor.ui.registry));


var keys = '';
for (var key in editor) {
    // Javascript의 for-in문을 사용해 key를 뽑아낼 수 있다.
    // key 변수에는 obj가 가진 key가 하나씩 들어온다.
    
    // 가져온 key를 이용해 value를 추출하자.
    // 두 가지 형식이 존재한다.
    //     1. obj.a
    //     2. obj[a]
    // alert(key);

    keys = keys + '<br>' +key;

}

// alert(keys);

    // editor.on('click', () => {
      // alert(JSON.stringify(editor));
      // console.log(editor);
    // });
    editor.ui.registry.addButton('urldialog', {
      icon: 'gallery',
      onAction: () => editor.windowManager.openUrl({
        title: 'URL Dialog Demo',
        url: 'https://example.com',
      })
    });

    // alert(JSON.stringify(editor.ui.registry));
    editor.ui.registry.addButton('hoho', {
      icon: 'gallery',
      onAction: () => editor.windowManager.openUrl({
        title: 'URL hoho Demo',
        url: 'https://example.com',
      })
    });

    // alert(JSON.stringify(editor.ui));
  },
  content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }'
}).then((editors) => {
  //https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.root/#init
  //이때의 editors는 init으로 초기화 된 모든 editor를 말함.
  //do something;
  // alert(Object.keys(editors)[0]);
            // for (var key in editors) {
              // Javascript의 for-in문을 사용해 key를 뽑아낼 수 있다.
              // key 변수에는 obj가 가진 key가 하나씩 들어온다.
              
              // 가져온 key를 이용해 value를 추출하자.
              // 두 가지 형식이 존재한다.
              //     1. obj.a
              //     2. obj[a]
              // alert(key);
            // }
});

// alert(JSON.stringify(a.Active));
// init 함수의 리턴값은 promise
</script>
    <div class="container mt-3">
      <h1 class="h1 fw-bold">J01</h1>
      <hr/>
      <textarea id="aa"></textarea>

      <hr/>
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal" id="modalStarter">
        파일업로드
      </button>

      <!-- Modal -->
      <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="uploadModalLabel">파일업로드</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalBody">
              ...
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
              <!-- <button type="button" class="btn btn-primary">do something</button> -->
            </div>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        document.getElementById("modalStarter").onclick = function(){
          const xhr = new XMLHttpRequest();
          xhr.open("get", "{% url 'J01:modal-list' %}");
          xhr.send();
          xhr.onload = function () {
            document.getElementById("modalBody").innerHTML = xhr.response };
        };
      </script>

    </div>


    <script>
  tinymce.init({
    selector: 'textarea',
    plugins: 'image media',
    toolbar: 'undo redo | blocks | bold italic | alignleft aligncentre alignright alignjustify | indent outdent | bullist numlist | upload',
    setup: (editor) => {
      editor.ui.registry.addButton('upload', {
        icon: 'gallery',
        onAction: () => {
          const xhr = new XMLHttpRequest();
          xhr.open("get", "{% url 'J01:modal-list' %}");
          xhr.send();
          xhr.onload = function () {
            document.getElementById("modalBody").innerHTML = xhr.response;
            
            const modal = new bootstrap.Modal('#uploadModal')
            modal.show();
          };  //xhr.onload
        } //onAction
      }); //editor.ui.registry.addButton
    }, //setup
  }).then((editors) => {
    //do something
  });
</script>

위의 경우 되긴되는데 새로 불러온 xhr.response에 javascript가 바인딩되지 않음..

{% endblock %}